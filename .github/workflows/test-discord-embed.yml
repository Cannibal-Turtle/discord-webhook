name: Test Discord Embed (Manual)

on:
  workflow_dispatch:
    inputs:
      channel:
        description: "Discord channel ID"
        required: true
        type: string
      title:
        description: "Embed title"
        required: true
        type: string
      desc:
        description: "Embed description"
        required: true
        type: string
      thumb:
        description: "Image/thumbnail URL"
        required: false
        type: string
      ping:
        description: "Ping line (role IDs etc.)"
        required: false
        type: string
      nsfw:
        description: "Blur thumbnail as spoiler? (0/1)"
        required: false
        default: "0"
        type: string
      use_image:
        description: "Use big image slot instead of thumbnail? (0/1)"
        required: false
        default: "0"
        type: string

jobs:
  send:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install deps
        run: |
          python -m pip install -U discord.py aiohttp

      - name: Run tester
        env:
          DISCORD_BOT_TOKEN: ${{ secrets.DISCORD_BOT_TOKEN }}
        run: |
          python test_send_embed.py \
            --channel "${{ inputs.channel }}" \
            --title   "${{ inputs.title }}" \
            --desc    "${{ inputs.desc }}" \
            $([ -n "${{ inputs.thumb }}" ] && echo --thumb "${{ inputs.thumb }}") \
            $([ -n "${{ inputs.ping }}" ] && echo --ping "${{ inputs.ping }}") \
            $([ "${{ inputs.nsfw }}" = "1" ] && echo --nsfw 1) \
            $([ "${{ inputs.use_image }}" = "1" ] && echo --use-image)
